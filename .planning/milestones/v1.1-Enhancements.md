# Milestone v1.1: Enhancements

**Status:** âœ… SHIPPED 2026-01-08
**Phases:** 7-9 (plus 7.1 inserted)
**Total Plans:** 7

## Overview

Enhanced search and download experience with MAM series detection, batch operations for multiple downloads, and series number organization templates. This milestone focused on improving the user experience for managing audiobook series and handling bulk downloads efficiently.

## Phases

### Phase 7: MAM Series Detection

**Goal**: Parse and extract series information from MAM search results and display in UI
**Depends on**: v1.0 MVP complete
**Plans**: 2 plans

Plans:

- [x] 07-01: Backend series parsing - return structured series data
- [x] 07-02: Frontend series grouping and display

**Details:**

Transformed series handling from simple string concatenation to structured data with ID, Name, and Number fields. Backend now parses MAM's JSON format and returns SeriesInfo arrays supporting books in multiple series. Frontend groups search results by series with numerical ordering using Array.reduce() and parseFloat() sorting. Books in multiple series appear in each group for better discoverability.

**Key Technical Decisions:**
- SeriesInfo struct with string fields (accommodates various number formats like "1", "Book 1", "1.5")
- Empty array for books without series (not null) for consistent API responses
- Client-side grouping with native Array methods (no dependencies)
- useMemo caches grouped results for performance with large result sets

### Phase 7.1: Fix Series Download Field (INSERTED)

**Goal**: Fix download requests to send series name only, not name with number
**Depends on**: Phase 7
**Plans**: 1 plan

Plans:

- [x] 07.1-01: Fix series field in download handlers

**Details:**

Urgent fix discovered during Phase 7 testing. When clicking download, the series field being sent included the series number (e.g., "Discworld #1" instead of "Discworld"), causing the organization function to create incorrect folder structures like `Discworld #1/book.m4b` instead of `Discworld/book.m4b`. Updated handlers to extract series name only before sending to backend.

**Insertion Rationale:** Critical bug that would compound with batch operations in Phase 8. Fixed immediately to prevent bad data from spreading.

### Phase 8: Batch Operations

**Goal**: Support adding multiple torrents simultaneously from search results
**Depends on**: Phase 7
**Plans**: 2 plans

Plans:

- [x] 08-01: Backend batch endpoint with partial success handling
- [x] 08-02: Frontend multi-select and batch UI

**Details:**

Added batch download capability with sequential processing to avoid overwhelming qBittorrent. Backend enforces 50-item limit and returns separate successful/failed arrays for graceful partial failure handling. Frontend provides multi-select checkboxes, floating action bar, and series group batch selection with indeterminate checkbox state when some books are selected.

**Key Technical Decisions:**
- Sequential processing prevents overwhelming qBittorrent
- 50-item maximum for system stability
- Partial success pattern returns 200 OK with detailed success/failure arrays
- Selection ID strategy uses `result.id || result.title` for results without ID fields
- Three notification states (all success, partial, all failed) for clear user feedback

### Phase 9: Series Number Organization

**Goal**: Add {series_number} template variable for folder organization
**Depends on**: Phase 8
**Plans**: 3 plans

Plans:

- [x] 09-01: Backend data model - add SeriesNumber field to Download
- [x] 09-02: Template and organization - support {series_number} variable
- [x] 09-03: Frontend integration - series_number input and display

**Details:**

Complete end-to-end series number support from MAM search through organized folders. Added SeriesNumber field to Download model with database migration, integrated {series_number} into template validation and organization logic, and updated frontend to extract series numbers from search results and display in config previews.

Example template: `{author}/{series}/{series_number} - {title}`
Example result: `Brandon Sanderson/Mistborn/1 - The Final Empire`

**Key Technical Decisions:**
- SeriesNumber stored as TEXT (string) to accommodate various formats
- Empty series_number replaced with empty string in templates (preserves user's template structure)
- First series used as primary for books in multiple series (typically the main series)
- Config help text updated to document {series_number} variable for discoverability

---

## Milestone Summary

**Decimal Phases:**

- Phase 7.1: Fix Series Download Field (inserted after Phase 7 for critical bug fix)

**Key Decisions:**

- Structured data over string concatenation: SeriesInfo[] enables sorting, grouping, and better data fidelity
- Sequential batch processing: Prevents overwhelming qBittorrent, more predictable behavior
- Partial success pattern: Graceful failure handling with clear user feedback
- First series as primary: Simple rule for books in multiple series
- Empty series_number handling: Preserves user's template structure

**Issues Resolved:**

- Fixed series download field sending "name #number" instead of just "name" (ISS-007.1)
- Added comprehensive type safety for SeriesInfo across frontend components
- Resolved template help text missing {series_number} variable

**Issues Deferred:**

None

**Technical Debt Incurred:**

- 07-03 plan created but not executed (pre-download confirmation modal) - deferred to future milestone

---

_For current project status, see .planning/ROADMAP.md_
