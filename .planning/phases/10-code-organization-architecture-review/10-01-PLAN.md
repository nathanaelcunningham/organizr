---
phase: 10-code-organization-architecture-review
plan: 01
type: execute
---

<objective>
Audit codebase structure, document architectural decisions, establish contribution guidelines, and identify areas for improvement.

Purpose: Create comprehensive documentation that makes the codebase accessible to future contributors and establishes quality standards for ongoing development.
Output: Architecture decision record, contribution guidelines, updated codebase documentation with current patterns and standards.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/STRUCTURE.md
@.planning/codebase/ARCHITECTURE.md
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/CONCERNS.md
@.planning/codebase/TESTING.md
@.planning/codebase/STACK.md
@.planning/codebase/INTEGRATIONS.md

**Established Patterns:**
- Repository pattern for data access with interface-based dependency injection
- Service layer orchestrates business logic
- Background monitoring via goroutines with context cancellation
- Frontend polling (3s intervals, auto-stops when idle)
- Zustand stores for centralized state management
- Structured data models over string concatenation
- Partial success patterns for batch operations

**Tech Stack:**
- Backend: Go 1.23, Chi router, SQLite with WAL mode
- Frontend: React 19, TypeScript, Vite, Zustand
- Testing: Go testing package (backend), Vitest (frontend)
- Integration: qBittorrent Web API, MyAnonamouse API

**Current State (v1.1 shipped):**
- ~9,500 LOC across backend and frontend
- Comprehensive backend tests with zero race conditions
- Production-ready with enhanced series support
- No authentication layer (single-user deployment assumption)

**Key Concerns from CONCERNS.md:**
- Hardcoded default credentials in migrations
- CORS wildcard configuration
- Multiple ignored I/O errors
- Context misuse in background organization
- No authentication/authorization
- No dependency version constraints documented
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Architecture Decision Record (ADR)</name>
  <files>docs/architecture/ADR.md</files>
  <action>
Create a comprehensive Architecture Decision Record documenting key technical decisions made during v1.0-v1.1 development. Structure as a markdown file with sections for each major decision area:

1. **Technology Stack Choices**
   - Why Go for backend (concurrency, static typing, stdlib)
   - Why React 19 + TypeScript + Vite for frontend
   - Why SQLite with WAL mode (single-user, embedded, sufficient)
   - Why Chi router (lightweight, standard middleware)
   - Why Zustand over Redux/Context (simplicity, performance)

2. **Architecture Patterns**
   - Repository pattern with interface-based DI (testability, flexibility)
   - Service layer separation (business logic isolation)
   - Background monitoring via goroutines (Go idiom, concurrent)
   - Polling vs WebSockets for real-time updates (simplicity, no connection management)
   - Template-based folder organization (flexibility, user control)

3. **Data Model Decisions**
   - SeriesInfo as structured array vs concatenated string (enables grouping, sorting)
   - Series numbers as strings vs integers (accommodate formats like "1.5", "Book 1")
   - Empty series_number as empty string vs null (template simplicity)
   - First series as primary for organization (simple rule, main series typically first)

4. **API Design Decisions**
   - Partial success pattern for batch operations (user feedback, graceful degradation)
   - Sequential batch processing vs concurrent (avoid overwhelming qBittorrent)
   - 50-item batch limit (prevent abuse, maintain stability)
   - RESTful endpoints with JSON payloads (standard, widely supported)

5. **Error Handling Strategy**
   - User-friendly messages without exposing internals (security, UX)
   - 5-minute timeout for organization (balance large files vs hanging)
   - Monitor resilience when qBittorrent unavailable (continue monitoring, log warnings)
   - All-or-nothing copy operations with cleanup (consistency, no partial state)

6. **Testing Philosophy**
   - Interface-based testing with mock dependencies (fast, isolated)
   - Race detection requirement (concurrency safety)
   - Comprehensive handler tests (API contract verification)
   - Zero race conditions achieved (proven concurrent safety)

7. **Security Posture**
   - Single-user deployment assumption (no auth layer in v1)
   - Private tracker authentication via torrent file downloads (MAM requirement)
   - Path sanitization for file organization (prevent traversal)

Each decision should follow format:
- **Context**: What problem were we solving?
- **Decision**: What did we choose?
- **Rationale**: Why did we choose this?
- **Consequences**: What are the tradeoffs?
- **Status**: Accepted / Proposed / Deprecated

Include timestamp and version context (e.g., "Decided: v1.0, Status: Accepted").
</action>
  <verify>docs/architecture/ADR.md exists with all 7 decision areas documented</verify>
  <done>Architecture Decision Record created documenting all major technical decisions from v1.0-v1.1 with context, rationale, and tradeoffs</done>
</task>

<task type="auto">
  <name>Task 2: Create Contribution Guidelines</name>
  <files>CONTRIBUTING.md</files>
  <action>
Create comprehensive contribution guidelines at repository root. Include:

1. **Getting Started**
   - Prerequisites (Go 1.23+, Node 20+, qBittorrent)
   - Clone and setup instructions
   - Backend: `cd backend && make build && make run`
   - Frontend: `cd frontend && npm install && npm run dev`
   - Running tests: Backend `make test`, Frontend `npm test`

2. **Project Structure Overview**
   - High-level directory layout (backend/internal structure, frontend/src structure)
   - Point to docs/architecture/ADR.md for detailed decisions
   - Point to .planning/codebase/ for comprehensive codebase documentation

3. **Development Workflow**
   - Create feature branch from main
   - Make changes following coding conventions (see below)
   - Run tests locally (backend: `make test`, frontend: `npm test`)
   - Ensure race detection passes (`cd backend && go test -race ./...`)
   - Commit with conventional commit format: `type(scope): description`
   - Push and create pull request

4. **Coding Conventions**
   - Backend (Go): Follow standard Go conventions, use gofmt, repository pattern for data access, service layer for business logic
   - Frontend (TypeScript): ESLint rules enforced, 2-space indent, PascalCase for components, camelCase for functions/variables
   - Imports: Group by stdlib, external, internal with blank lines between
   - Error handling: Always check and wrap errors in Go, use APIClientError in TypeScript
   - Comments: Explain why not what, document business logic and edge cases

5. **Testing Standards**
   - Backend: Unit tests alongside source (*_test.go), mock dependencies via interfaces, table-driven tests for multiple cases
   - Frontend: Vitest for unit tests, test stores and utilities, avoid testing implementation details
   - Race detection: All concurrent code must pass `go test -race`
   - Coverage: Focus on critical paths (handlers, services, organization logic)

6. **Commit Message Format**
   - Follow Conventional Commits: `type(scope): description`
   - Types: feat, fix, docs, refactor, test, chore
   - Scope: phase-plan format (e.g., `feat(10-01): add ADR`)
   - Examples:
     - `feat(11-02): standardize error responses`
     - `fix(12-01): correct race condition in monitor`
     - `docs(10-01): add contribution guidelines`

7. **Pull Request Guidelines**
   - Title follows commit format
   - Description explains what and why
   - Link related issues if applicable
   - Tests passing and race-free
   - Documentation updated if needed

8. **Code Review Expectations**
   - Reviewers check for adherence to conventions
   - Focus on correctness, readability, test coverage
   - Security considerations (path sanitization, error handling)
   - Performance considerations (avoid N+1 queries, unnecessary allocations)

9. **Getting Help**
   - Check docs/architecture/ for architectural decisions
   - Check .planning/codebase/ for codebase structure and patterns
   - Open issue for questions or clarifications

Keep tone welcoming and encouraging. Use clear examples. Reference existing good patterns in codebase.
</action>
  <verify>CONTRIBUTING.md exists at repository root with all 9 sections</verify>
  <done>Contribution guidelines created covering setup, workflow, conventions, testing, commits, PRs, and code review</done>
</task>

<task type="auto">
  <name>Task 3: Update Codebase Documentation</name>
  <files>.planning/codebase/STRUCTURE.md, .planning/codebase/CONVENTIONS.md, .planning/codebase/ARCHITECTURE.md</files>
  <action>
Update codebase documentation to reflect current state after v1.1 completion and document patterns established:

**STRUCTURE.md updates:**
- Update "Testing" section from "None detected" to document test files present:
  - Backend: `backend/internal/server/handlers_test.go`, `backend/internal/downloads/monitor_test.go`, etc.
  - Frontend: `frontend/src/test/` directory with Vitest setup
- Update "Current State" timestamp to 2026-01-08 (v1.1 complete)
- Add testing location guidance: "New tests: `*_test.go` alongside source (backend), `*.test.ts` or `test/` directory (frontend)"

**CONVENTIONS.md updates:**
- Add "Testing Conventions" section:
  - Backend: Table-driven tests with subtests, interface mocking for dependencies, race detection required
  - Frontend: Vitest with jsdom, test stores and utilities, avoid implementation details
  - Naming: `Test<FunctionName>` for Go, `describe/it` for TypeScript
- Add "Commit Message Format" section:
  - Conventional Commits: `type(scope): description`
  - Scope uses phase-plan format: `feat(09-02): add series_number template`
  - Examples from recent commits
- Update timestamp to 2026-01-08

**ARCHITECTURE.md updates:**
- Add "Testing Strategy" subsection under "Cross-Cutting Concerns":
  - Interface-based testing with mock dependencies
  - Comprehensive handler tests for API contract verification
  - Race detection requirement (all concurrent code)
  - Zero race conditions achieved in v1.0-v1.1
- Add "Commit and Version Control" subsection:
  - Atomic commits per task (1 commit per task)
  - Conventional commit format with phase-plan scope
  - Git history provides granular observability
- Update "Current State" references to v1.1 (was v1.0)
- Update timestamp to 2026-01-08

Keep all existing content, only add/update sections listed above. Maintain existing markdown structure and formatting.
</action>
  <verify>All three files updated with new sections, timestamps updated to 2026-01-08</verify>
  <done>Codebase documentation updated to reflect v1.1 completion, testing patterns, and commit conventions</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] docs/architecture/ADR.md exists with comprehensive decision documentation
- [ ] CONTRIBUTING.md exists at repository root with clear guidelines
- [ ] .planning/codebase/ documentation updated to reflect current state
- [ ] All files use consistent markdown formatting
- [ ] No broken internal references between documentation files
</verification>

<success_criteria>

- All tasks completed
- Architecture decisions documented with context and rationale
- Contribution guidelines provide clear onboarding path
- Codebase documentation reflects v1.1 state and established patterns
- Documentation is accessible and helpful for future contributors
  </success_criteria>

<output>
After completion, create `.planning/phases/10-code-organization-architecture-review/10-01-SUMMARY.md`:

---
phase: 10-code-organization-architecture-review
plan: 01
subsystem: documentation
tags: [architecture, documentation, onboarding]

# Dependency graph
requires: []
provides:
  - Architecture Decision Record (ADR)
  - Contribution guidelines (CONTRIBUTING.md)
  - Updated codebase documentation
affects:
  - phase: 11
    why: API cleanup will reference ADR for consistency
  - phase: 13
    why: Developer docs will build on architecture docs

# Tech tracking
tech-stack:
  added: []
  patterns: []

key-files:
  created:
    - docs/architecture/ADR.md
    - CONTRIBUTING.md
  modified:
    - .planning/codebase/STRUCTURE.md
    - .planning/codebase/CONVENTIONS.md
    - .planning/codebase/ARCHITECTURE.md

key-decisions: []

patterns-established:
  - Architecture Decision Record format for documenting technical choices
  - Conventional Commits with phase-plan scoping
  - Contribution guidelines as single-source onboarding

issues-created: []

duration: [actual]
completed: [timestamp]
---

# Phase 10 Plan 1: Code Organization & Architecture Review Summary

**[One-line summary of what shipped]**

## Performance

- **Duration:** [X] min
- **Started:** [timestamp]
- **Completed:** [timestamp]
- **Tasks:** 3
- **Files created:** 2
- **Files modified:** 3

## Accomplishments

- Architecture Decision Record documents all major technical decisions from v1.0-v1.1
- Contribution guidelines provide clear onboarding for new contributors
- Codebase documentation updated to reflect current testing patterns and commit conventions
- Documentation structure supports future phases (API cleanup, testing, developer docs)

## Task Commits

1. **Task 1: Create Architecture Decision Record** - [commit hash] (docs)
2. **Task 2: Create Contribution Guidelines** - [commit hash] (docs)
3. **Task 3: Update Codebase Documentation** - [commit hash] (docs)

**Plan metadata:** (will be added in docs commit)

## Files Created/Modified

- `docs/architecture/ADR.md` - Comprehensive architectural decision documentation
- `CONTRIBUTING.md` - Contribution guidelines with setup, workflow, conventions
- `.planning/codebase/STRUCTURE.md` - Updated testing locations and guidance
- `.planning/codebase/CONVENTIONS.md` - Added testing and commit conventions
- `.planning/codebase/ARCHITECTURE.md` - Added testing strategy and version control sections

## Decisions Made

[Document any decisions made during execution]

## Deviations from Plan

[Document any deviations - should be none for documentation task]

## Issues Encountered

[Document any issues - should be none for straightforward documentation]

## Next Phase Readiness

Phase 10 complete! Documentation foundation established for:
- Phase 11: API Layer Cleanup (will reference ADR for consistency)
- Phase 12: Testing Infrastructure (builds on documented testing patterns)
- Phase 13: Developer Documentation (extends architecture docs)

Ready to proceed with `/gsd:plan-phase 11` (API Layer Cleanup).

---
*Phase: 10-code-organization-architecture-review*
*Completed: [date]*
</output>
