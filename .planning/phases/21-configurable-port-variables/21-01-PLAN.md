---
phase: 21-configurable-port-variables
plan: 01
type: execute
---

<objective>
Add environment variables for frontend and backend port configuration in Docker Compose to enable flexible production deployments.

Purpose: Allow users to customize port mappings without editing docker-compose.yml directly, supporting deployments where default ports conflict with existing services.
Output: FRONTEND_PORT and BACKEND_PORT environment variables with docker-compose.yml using variable substitution for host port mappings.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-environment-configuration/18-01-SUMMARY.md
@.planning/phases/17-docker-compose-setup/17-01-SUMMARY.md
@docker-compose.yml
@.env.example

**Tech stack available:** godotenv, Docker Compose environment variables
**Established patterns:** Environment variable naming (uppercase with underscores), .env.example documentation with descriptions and defaults, docker-compose.yml env_file usage with variable substitution

**Constraining decisions:**
- Phase 18: Environment variable precedence pattern (ENV > Database > Defaults) for application config
- Phase 17: Frontend on host port 8081, backend on host port 8080 to avoid conflicts

**Context:** Phase 18 established comprehensive environment variable support for all application configuration options (qBittorrent, paths, monitoring, MAM). This phase extends that pattern to Docker Compose service port mappings, which are currently hardcoded. This enables production deployments where default ports may conflict with existing services (e.g., another service already using port 8080 or 8081).
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add port environment variables to .env.example</name>
  <files>.env.example</files>
  <action>Add a new "Docker Compose Configuration" section at the top of .env.example (before "Database" section) with FRONTEND_PORT and BACKEND_PORT variables. Document that these control host port mappings in docker-compose.yml. Set default values: BACKEND_PORT=8080, FRONTEND_PORT=8081. Include clear descriptions explaining these are host ports (not container ports, which remain fixed). Add usage note that changing these requires docker-compose restart to take effect.</action>
  <verify>grep -A 3 "Docker Compose Configuration" .env.example shows both PORT variables with defaults and descriptions</verify>
  <done>FRONTEND_PORT and BACKEND_PORT documented in .env.example with defaults, descriptions, and usage notes</done>
</task>

<task type="auto">
  <name>Task 2: Update docker-compose.yml port mappings</name>
  <files>docker-compose.yml</files>
  <action>Replace hardcoded host ports with environment variable substitution. Backend ports line changes from "8080:8080" to "${BACKEND_PORT:-8080}:8080". Frontend ports line changes from "8081:8080" to "${FRONTEND_PORT:-8081}:8080". Use bash parameter expansion syntax with :- for default values (Docker Compose standard). Container ports remain unchanged (backend listens on 8080, frontend nginx on 8080). Do NOT add these to the environment: section - they are only for port mapping, not passed into containers.</action>
  <verify>grep "ports:" -A 1 docker-compose.yml shows ${BACKEND_PORT:-8080} and ${FRONTEND_PORT:-8081} with proper default values</verify>
  <done>docker-compose.yml uses BACKEND_PORT and FRONTEND_PORT variables for host port mappings with proper defaults</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] .env.example contains BACKEND_PORT and FRONTEND_PORT with documentation
- [ ] docker-compose.yml uses ${BACKEND_PORT:-8080} and ${FRONTEND_PORT:-8081}
- [ ] docker-compose config validates without errors
- [ ] Test with custom ports: BACKEND_PORT=9090 FRONTEND_PORT=9091 docker-compose config shows correct port mappings
</verification>

<success_criteria>

- All tasks completed
- Port variables documented in .env.example
- docker-compose.yml uses environment variable substitution for host ports
- docker-compose config validates successfully
- Default behavior unchanged (8080 and 8081)
- Custom ports work when set via environment variables
</success_criteria>

<output>
After completion, create `.planning/phases/21-configurable-port-variables/21-01-SUMMARY.md`:

# Phase 21 Plan 01: Configurable Port Variables Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- Added FRONTEND_PORT and BACKEND_PORT environment variables to .env.example
- Updated docker-compose.yml to use port variables with default values
- Enabled flexible production deployments without editing compose file

## Files Created/Modified

- `.env.example` - Added Docker Compose Configuration section with port variables
- `docker-compose.yml` - Replaced hardcoded ports with environment variable substitution

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 21 complete, v1.3 Production Deployment milestone complete. Ready for milestone completion and archival.
</output>
