---
phase: 11-api-layer-cleanup
plan: 03
type: execute
---

<objective>
Review and standardize API response patterns for consistency across all endpoints.

Purpose: Ensure predictable response structures, consistent field naming, and proper wrapping for all API responses.
Output: Standardized response patterns with consistent naming conventions, all responses properly typed and wrapped.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-api-layer-cleanup/11-01-SUMMARY.md
@.planning/phases/11-api-layer-cleanup/11-02-SUMMARY.md

# API response types
@backend/internal/server/request_types.go
@backend/internal/server/dto.go
@backend/internal/server/errors.go

**Current state:**
- Response types defined in request_types.go
- DTOs defined in dto.go (downloadDTO, searchResultDTO)
- Error responses in errors.go (ErrorResponse)
- Mix of wrapped and unwrapped responses

**Existing response patterns:**
- Wrapped: `CreateDownloadResponse{Download: downloadDTO}`
- Wrapped: `ListDownloadsResponse{Downloads: []downloadDTO}`
- Wrapped: `SearchResponse{Results: []searchResultDTO, Count: int}`
- Wrapped: `ErrorResponse{Error: string, Message: string, Code: int}`
- Consistency: Most responses are wrapped, need to verify all are consistent

**Naming patterns to verify:**
- Response types: PascalCase with "Response" suffix
- DTOs: camelCase with "DTO" suffix
- Fields: camelCase in structs, snake_case in JSON tags
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and standardize response type naming</name>
  <files>backend/internal/server/request_types.go, backend/internal/server/dto.go</files>
  <action>
Review all response types and DTOs for naming consistency:

1. **Response types** (in request_types.go):
   - Verify all follow pattern: `<Operation><Resource>Response` (e.g., `CreateDownloadResponse`, `ListDownloadsResponse`)
   - Verify all have "Response" suffix
   - Check for any inconsistencies (e.g., missing Response suffix, unclear operation names)

2. **DTO types** (in dto.go):
   - Verify all follow pattern: `<resource>DTO` (e.g., `downloadDTO`, `searchResultDTO`)
   - Verify lowercase first letter (unexported, used only internally)
   - Check JSON tags use snake_case consistently

3. **Response wrapping**:
   - Verify all success responses wrap their data (not returning bare DTOs or primitives)
   - Examples of proper wrapping:
     - Single resource: `{download: downloadDTO}` not bare `downloadDTO`
     - List: `{downloads: []downloadDTO}` not bare `[]downloadDTO`
     - Metadata: `{results: []searchResultDTO, count: int}` includes count

4. **Error responses**:
   - Verify ErrorResponse struct is used consistently (already standardized in 11-01)
   - Check structure has error, message, code fields

Create a document summarizing:
- Any naming inconsistencies found
- Any unwrapped responses that need wrapping
- Any missing response types
- Recommendations for standardization

If all patterns are already consistent, document that fact. If inconsistencies found, document what needs fixing for Task 2.

WHY audit first: Understanding current state before making changes prevents breaking existing API contracts accidentally.

WHY wrapping: Consistent response structure makes API clients easier to write and maintain, allows for future extension (e.g., adding pagination metadata).
  </action>
  <verify>
All response types reviewed and documented
List of any inconsistencies or issues created
Clear recommendations for standardization (if needed)
  </verify>
  <done>
Complete audit of response types and DTOs performed
Document created listing current patterns and any issues
Clear understanding of what (if anything) needs standardization
Recommendations documented for Task 2
  </done>
</task>

<task type="auto">
  <name>Task 2: Apply response pattern standardization</name>
  <files>backend/internal/server/request_types.go, backend/internal/server/dto.go, backend/internal/server/handlers.go</files>
  <action>
Based on audit from Task 1, apply standardization fixes:

**If inconsistencies found:**

1. Rename any response types that don't follow `<Operation><Resource>Response` pattern
2. Add Response suffix to any types missing it
3. Wrap any bare DTO returns with proper response types
4. Fix any JSON tag inconsistencies (all should be snake_case)
5. Update handler functions to use corrected response types
6. Update OpenAPI annotations if response types changed

**If no inconsistencies found:**

1. Document that all patterns are already consistent
2. Add comments to request_types.go and dto.go documenting naming conventions:
   ```go
   // Response types follow the pattern: <Operation><Resource>Response
   // All responses wrap their data for consistency and future extensibility
   // Examples: CreateDownloadResponse, ListDownloadsResponse, GetConfigResponse
   ```

3. Verify all handlers use response types correctly (no bare returns)

**Breaking change considerations:**
- These are internal Go types, JSON response shape stays the same
- Frontend uses JSON field names, not Go struct names
- No breaking changes expected if JSON tags remain consistent

WHY standardize now: Early in development, before external API consumers depend on inconsistent patterns. Cost of change is low now.

WHY document conventions: Makes future development consistent, helps contributors understand patterns.
  </action>
  <verify>
go build backend/cmd/api succeeds
go test backend/internal/server/... passes
All response types follow consistent naming pattern
All responses properly wrapped with response types
Documentation comments added explaining conventions
  </verify>
  <done>
All response types follow standard naming conventions
All API responses consistently wrapped
JSON tags all use snake_case consistently
Documentation comments added to request_types.go and dto.go
Build and tests pass
No breaking changes to API contracts (JSON response shapes unchanged)
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build backend/cmd/api` succeeds without errors
- [ ] `go test backend/internal/server/...` passes all tests
- [ ] All response types follow `<Operation><Resource>Response` naming pattern
- [ ] All DTOs follow `<resource>DTO` naming pattern
- [ ] All responses properly wrapped (no bare DTO returns)
- [ ] JSON tags consistently use snake_case
- [ ] Documentation comments explain conventions
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Audit document created identifying any issues
- All response patterns standardized and consistent
- Documentation comments added explaining conventions
- No breaking changes to API contracts
- Build and all tests pass
- Phase 11 complete - ready for Phase 12
</success_criteria>

<output>
After completion, create `.planning/phases/11-api-layer-cleanup/11-03-SUMMARY.md`:

# Phase 11 Plan 3: Response Pattern Standardization Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description
- `path/to/another.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Phase 11 complete! API layer cleanup finished with:
- Standardized error handling with typed helpers
- Comprehensive OpenAPI/Swagger documentation
- Consistent response patterns across all endpoints

Ready for Phase 12: Testing Infrastructure
</output>
