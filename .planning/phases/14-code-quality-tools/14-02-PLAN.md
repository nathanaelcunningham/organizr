---
phase: 14-code-quality-tools
plan: 02
type: execute
---

<objective>
Add pre-commit hooks for local quality checks and enforce linting/formatting in CI.

Purpose: Catch code quality issues before they reach the repository and enforce standards in CI to prevent regressions.
Output: pre-commit hooks for Go and TypeScript, GitHub Actions workflow updated with lint and format checks.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-code-quality-tools/14-01-PLAN.md
@.github/workflows/test.yml
@backend/Makefile
@frontend/package.json

**Tech stack available:** Go 1.25.3, golangci-lint, React 19, TypeScript 5.9, Prettier, ESLint 9, GitHub Actions
**Established patterns:** GitHub Actions CI with backend/frontend jobs, make targets for backend, npm scripts for frontend
**Constraining decisions:**
- Phase 14-01: golangci-lint and Prettier configured with make lint and npm run format:check commands

**Current state:**
- Linting and formatting configured locally (14-01)
- No pre-commit hooks
- CI runs tests but not linting/formatting checks
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure pre-commit hooks with Husky</name>
  <files>frontend/package.json, .husky/pre-commit, backend/Makefile</files>
  <action>Add pre-commit hooks to catch quality issues before commit:

**1. Install Husky in frontend:**
```bash
cd frontend
npm install --save-dev husky
```

**2. Initialize Husky:**
```bash
cd frontend
npx husky init
```

This creates `.husky/` directory with pre-commit hook.

**3. Configure pre-commit hook:**

Edit `.husky/pre-commit`:
```bash
#!/usr/bin/env sh

# Frontend checks (TypeScript, formatting, linting)
echo "Running frontend checks..."
cd frontend
npm run format:check || exit 1
npm run lint || exit 1
npm run type-check || exit 1
cd ..

# Backend checks (Go linting)
echo "Running backend checks..."
cd backend
make lint || exit 1
cd ..

echo "âœ“ Pre-commit checks passed"
```

Make it executable:
```bash
chmod +x .husky/pre-commit
```

**4. Add type-check script to frontend package.json:**
```json
"scripts": {
  ...existing,
  "type-check": "tsc --noEmit"
}
```

**5. Update frontend package.json scripts:**
Add prepare script to install Husky hooks automatically:
```json
"scripts": {
  ...existing,
  "prepare": "cd .. && husky frontend/.husky"
}
```

**What to avoid:** Don't run full test suites in pre-commit hooks (too slow) - save for CI. Focus on fast checks: linting, formatting, type checking. Don't use lint-staged for now (adds complexity) - check all files (fast enough for this codebase size).</action>
  <verify>git add . && git commit -m "test" triggers pre-commit hook (checks run), can abort with Ctrl+C</verify>
  <done>Husky installed, pre-commit hook configured to run format:check, lint, and type-check for frontend, lint for backend</done>
</task>

<task type="auto">
  <name>Task 2: Add linting and formatting checks to GitHub Actions CI</name>
  <files>.github/workflows/test.yml</files>
  <action>Add quality checks to CI workflow before running tests:

**Update `.github/workflows/test.yml`:**

Add new jobs for linting and formatting that run in parallel with tests:

```yaml
name: Test

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  backend-lint:
    name: Backend Lint
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.25'

      - name: Install golangci-lint
        run: |
          curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b $(go env GOPATH)/bin v1.61.0

      - name: Run golangci-lint
        working-directory: ./backend
        run: $(go env GOPATH)/bin/golangci-lint run ./...

  backend-test:
    name: Backend Tests
    runs-on: ubuntu-latest

    steps:
      # ...existing backend test steps (unchanged)

  frontend-lint:
    name: Frontend Lint & Format
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json

      - name: Install dependencies
        working-directory: ./frontend
        run: npm ci

      - name: Check formatting
        working-directory: ./frontend
        run: npm run format:check

      - name: Run ESLint
        working-directory: ./frontend
        run: npm run lint

      - name: Type check
        working-directory: ./frontend
        run: npm run type-check

  frontend-test:
    name: Frontend Tests
    runs-on: ubuntu-latest

    steps:
      # ...existing frontend test steps (unchanged)
```

**Key changes:**
- Split backend into `backend-lint` and `backend-test` jobs (run in parallel)
- Split frontend into `frontend-lint` and `frontend-test` jobs (run in parallel)
- All jobs run in parallel - CI will fail fast if any quality check fails
- Use golangci-lint GitHub Action installer (fast, caches binary)

**What to avoid:** Don't create a single job that runs sequentially (slower). Run quality checks in parallel with tests for fastest feedback. Don't fail the entire workflow if docs-only changes - keep focused on code quality.</action>
  <verify>CI workflow file is valid YAML, jobs are properly named, working-directory paths are correct</verify>
  <done>GitHub Actions workflow updated with backend-lint and frontend-lint jobs running in parallel with tests</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Pre-commit hook exists and is executable
- [ ] `git commit` triggers pre-commit checks for both backend and frontend
- [ ] `.github/workflows/test.yml` has 4 jobs: backend-lint, backend-test, frontend-lint, frontend-test
- [ ] CI workflow syntax is valid (test locally with `act` or push to verify)
- [ ] All quality checks pass locally before push
</verification>

<success_criteria>

- All tasks completed
- Pre-commit hooks configured and working
- GitHub Actions CI enforces linting and formatting
- Quality checks run in parallel with tests for fast feedback
- Phase 14 complete: comprehensive code quality tooling in place
</success_criteria>

<output>
After completion, create `.planning/phases/14-code-quality-tools/14-02-SUMMARY.md`:

---
phase: 14-code-quality-tools
plan: 02
subsystem: code-quality
tags: [pre-commit, husky, ci, github-actions, quality-gates]

# Dependency graph
requires:
  - phase: 14-code-quality-tools
    plan: 01
    provides: golangci-lint and Prettier configured with lint/format commands
provides:
  - Pre-commit hooks for catching quality issues before commit
  - CI enforcement of linting and formatting standards
  - Parallel quality checks in GitHub Actions for fast feedback
affects: [15-refactoring-opportunities, all-future-development]

# Tech tracking
tech-stack:
  added: [husky]
  patterns: [pre-commit-hooks, ci-quality-gates, parallel-ci-jobs]

key-files:
  created:
    - .husky/pre-commit
  modified:
    - frontend/package.json
    - .github/workflows/test.yml

key-decisions:
  - "Husky for pre-commit hooks (standard in Node.js ecosystem)"
  - "Run quality checks in parallel with tests in CI (fast feedback)"
  - "Pre-commit checks: format, lint, type-check (skip tests for speed)"
  - "golangci-lint GitHub Action installer for caching and speed"

---

# Phase 14 Plan 2: Pre-commit Hooks and CI Enforcement Summary

**Pre-commit hooks with Husky and parallel CI quality checks for fast feedback**

## Accomplishments

- Configured Husky pre-commit hooks for both backend and frontend
- Added format:check, lint, and type-check to pre-commit (fast, catches issues early)
- Restructured GitHub Actions CI into 4 parallel jobs: backend-lint, backend-test, frontend-lint, frontend-test
- All quality checks now enforced in CI before merge
- Fast feedback: quality checks run in parallel with tests

## Files Created/Modified

- `.husky/pre-commit` - Pre-commit hook running format, lint, type checks
- `frontend/package.json` - Added husky, prepare script, type-check script
- `.github/workflows/test.yml` - Split into 4 parallel jobs with quality gates

## Decisions Made

- **Husky over alternatives**: Standard pre-commit tool in Node.js ecosystem, simple setup
- **Parallel CI jobs**: Quality checks run alongside tests (not sequentially) for faster feedback
- **Pre-commit scope**: Format + lint + type-check (skip tests - too slow for pre-commit)
- **No lint-staged**: Codebase small enough, full checks are fast

## Issues Encountered

None

## Next Phase Readiness

Phase 14 (Code Quality Tools) complete. Ready for Phase 15 (Refactoring Opportunities).

**Quality tooling established:**
- Backend: golangci-lint with pragmatic ruleset
- Frontend: Prettier + ESLint 9 + TypeScript checking
- Pre-commit: Automatic checks before commit
- CI: Parallel quality gates (4 jobs)

All future code changes will go through quality checks before reaching main branch.
</output>
