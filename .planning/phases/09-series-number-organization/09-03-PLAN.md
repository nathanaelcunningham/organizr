---
phase: 09-series-number-organization
plan: 03
type: execute
---

<objective>
Update frontend to extract series numbers from search results and pass them through download and config APIs.

Purpose: Complete the series_number feature by connecting frontend UI to backend series_number support.
Output: Frontend extracts SeriesInfo.Number from MAM results, sends series_number in download requests, displays series_number in config preview.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Relevant prior work
@.planning/phases/07-mam-series-detection/07-02-SUMMARY.md
@.planning/phases/7.1-fix-series-download-field/07.1-01-SUMMARY.md
@.planning/phases/09-series-number-organization/09-01-SUMMARY.md
@.planning/phases/09-series-number-organization/09-02-SUMMARY.md

# Key source files
@frontend/src/types/download.ts
@frontend/src/types/search.ts
@frontend/src/api/downloads.ts
@frontend/src/api/config.ts
@frontend/src/pages/SearchPage.tsx
@frontend/src/components/config/ConfigForm.tsx

**Tech stack available:**
- React with TypeScript
- Zustand stores for state management
- Structured series data with SeriesInfo type (Phase 7)
- Real-time config preview with 500ms debounce (Phase 3)

**Established patterns:**
- Extract series name from SeriesInfo array in download handlers (Phase 7.1)
- Multi-select with batch operations (Phase 8)
- Debounced API calls for preview (Phase 3)

**Constraining decisions:**
- Series stored as []SeriesInfo array, use first series for download (Phase 7)
- Series field must be name only, not "name #number" (Phase 7.1 fix)
- Selection ID uses result.id || result.title (Phase 8)

**Context:**
Plans 1-2 added backend support for series_number in Download model, template system, and organization logic. Now the frontend needs to:
1. Extract SeriesInfo.Number from the first series in search results
2. Send series_number along with series name in download requests
3. Include series_number in config preview for template testing

Key insight: Phase 7.1 fixed the bug where we sent "Series #1" instead of "Series". Now we send series name and series number as separate fields.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update frontend types and API clients for series_number</name>
  <files>frontend/src/types/download.ts, frontend/src/api/downloads.ts, frontend/src/api/config.ts</files>
  <action>
    Update types/download.ts:
    - Add seriesNumber?: string to Download interface
    - Add seriesNumber?: string to CreateDownloadRequest interface

    Update api/downloads.ts:
    - No changes needed - CreateDownloadRequest type update is sufficient, API client will send seriesNumber field automatically

    Update api/config.ts:
    - Add seriesNumber?: string to PreviewPathRequest interface
    - previewPath function already sends entire PreviewPathRequest, no code changes needed

    TypeScript types ensure type safety across frontend-backend boundary.
  </action>
  <verify>npm run build succeeds, TypeScript compilation clean</verify>
  <done>Frontend types updated with seriesNumber fields, TypeScript compilation succeeds</done>
</task>

<task type="auto">
  <name>Task 2: Update download handlers to extract and send series_number</name>
  <files>frontend/src/pages/SearchPage.tsx</files>
  <action>
    Update SearchPage.tsx in download creation logic (around handleDownload and handleBatchDownload functions):

    Current code (from Phase 7.1 fix):
    ```typescript
    series: result.series.length > 0 ? result.series[0].name : ''
    ```

    Add series_number extraction:
    ```typescript
    series: result.series.length > 0 ? result.series[0].name : '',
    seriesNumber: result.series.length > 0 ? result.series[0].number : ''
    ```

    This extracts:
    - series: "Discworld" (name only)
    - seriesNumber: "1" (number only)

    Update both:
    1. handleDownload (single download) - add seriesNumber to createDownload() call
    2. handleBatchDownload (batch download) - add seriesNumber to batch array items

    Why first series: Books can belong to multiple series, but organization templates use one primary series. Use first series (most relevant) for folder structure.

    Empty string handling: If series[0].number is empty or undefined, send empty string (backend accepts empty series_number).
  </action>
  <verify>npm run dev, click download on book with series, network tab shows series_number in request body</verify>
  <done>Download handlers extract series number from first SeriesInfo, send seriesNumber in create requests for both single and batch downloads</done>
</task>

<task type="auto">
  <name>Task 3: Update ConfigForm to include series_number in preview</name>
  <files>frontend/src/components/config/ConfigForm.tsx</files>
  <action>
    Update ConfigForm.tsx in preview logic (around previewPath API call):

    Current preview call (approximate):
    ```typescript
    const preview = await configApi.previewPath({
      template: formData.template,
      author: 'Example Author',
      series: 'Example Series',
      title: 'Example Book Title'
    });
    ```

    Add series_number to example data:
    ```typescript
    const preview = await configApi.previewPath({
      template: formData.template,
      author: 'Example Author',
      series: 'Example Series',
      seriesNumber: '1',  // Add example series number
      title: 'Example Book Title'
    });
    ```

    This enables users to test templates like:
    - "{author}/{series}/{series_number} - {title}" → "Example Author/Example Series/1 - Example Book Title"
    - "{series_number}. {title}" → "1. Example Book Title"

    Find the preview API call (likely in a debounced effect or handler) and add seriesNumber: '1' to the request object.

    Why use '1': Simple, realistic example that demonstrates series_number positioning in paths. Users understand "1" represents first book in series.
  </action>
  <verify>npm run dev, open config page, type template with {series_number}, verify preview shows "1" in path</verify>
  <done>Config form includes series_number in preview API calls, users see series_number in real-time path preview</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] npm run lint passes
- [ ] npm run test passes (if tests exist for affected components)
- [ ] Manual test: Download book with series, verify series_number sent in API request
- [ ] Manual test: Config preview with {series_number} shows "1" in path
</verification>

<success_criteria>

- Frontend types include seriesNumber fields
- Download handlers extract series number from SeriesInfo
- API requests include series_number for single and batch downloads
- Config preview includes series_number in template testing
- All TypeScript compilation succeeds
- No lint errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-series-number-organization/09-03-SUMMARY.md`:

# Phase 9 Plan 3: Frontend Integration Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- Frontend types updated with seriesNumber fields
- Download handlers extract series number from first SeriesInfo
- Config preview includes series_number for template testing
- End-to-end series_number flow complete

## Files Created/Modified

- `frontend/src/types/download.ts` - Added seriesNumber to Download and CreateDownloadRequest
- `frontend/src/api/config.ts` - Added seriesNumber to PreviewPathRequest
- `frontend/src/pages/SearchPage.tsx` - Extract and send series_number in downloads
- `frontend/src/components/config/ConfigForm.tsx` - Include series_number in preview

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 9 complete. Users can now use {series_number} in folder templates for organized audiobook libraries with series book numbering.
</output>
