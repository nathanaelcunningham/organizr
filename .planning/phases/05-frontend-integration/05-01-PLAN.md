---
phase: 05-frontend-integration
plan: 01
type: execute
---

<objective>
Verify and enhance the existing frontend-backend integration for real-time download status and organization progress display.

Purpose: Ensure the UI correctly reflects download lifecycle from queued → downloading → completed → organizing → organized, with real-time updates and proper error handling.
Output: Production-ready frontend integration with verified end-to-end flow, enhanced UX for organization status, and comprehensive error states.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-file-organization-engine/04-01-SUMMARY.md
@.planning/phases/02-download-monitoring/02-01-SUMMARY.md
@frontend/src/stores/useDownloadStore.ts
@frontend/src/components/downloads/DownloadCard.tsx
@frontend/src/pages/DownloadsPage.tsx
@frontend/src/types/download.ts
@backend/internal/downloads/monitor.go

**Tech stack available:**
- React with TypeScript
- Zustand for state management
- TailwindCSS for styling
- Polling mechanism (3-second interval)
- Existing Badge, ProgressBar, Card components

**Established patterns:**
- Zustand stores with polling for real-time updates
- Component-based UI with Tailwind classes
- Error handling via notification store
- Status-based filtering in DownloadsPage

**Constraining decisions:**
- Phase 2: Monitor auto-triggers organization on completion
- Phase 2: 3-second polling interval for status updates
- Phase 4: Organization includes disk space validation and partial failure recovery
- Existing UI: DownloadCard already displays organized_path when status is 'organized'

**Current state:**
The frontend integration is **largely complete**:
- DownloadCard displays progress, organized path, errors, and timestamps
- DownloadStore includes polling with auto-stop when no active downloads
- Status badges for all states including 'organizing' and 'organized'
- Manual "Organize Now" button for completed downloads

This phase focuses on **verification, enhancement, and UX polish** rather than new features.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify end-to-end integration with comprehensive testing</name>
  <files>frontend/src/stores/useDownloadStore.test.ts</files>
  <action>
    Create test file for DownloadStore with:
    - Test polling start/stop behavior
    - Test download creation triggers polling
    - Test polling stops when no active downloads
    - Test organize action updates state correctly
    - Test cancel action removes download from list
    - Test error handling for all actions
    - Mock downloadsApi responses

    Use Jest or Vitest (check package.json for test framework). Follow frontend test conventions (describe/it blocks, mock API calls).

    IMPORTANT: Focus on store logic (state updates, polling, actions) - do not test React component rendering.
  </action>
  <verify>npm test passes for useDownloadStore.test.ts with good coverage</verify>
  <done>Store logic verified, polling behavior tested, all actions covered</done>
</task>

<task type="auto">
  <name>Task 2: Add organization progress indicator and status messages</name>
  <files>frontend/src/components/downloads/DownloadCard.tsx</files>
  <action>
    Enhance DownloadCard to improve organization status UX:

    1. Add specific message for 'organizing' status: "Organizing files... Creating folder structure and copying files to destination."
    2. Update progress bar to show indeterminate state during organization (since backend doesn't report file-level progress)
    3. Add "Copy Path" button next to organized_path display (copies to clipboard, shows tooltip "Copied!")
    4. Improve error message display: Add "Retry Organization" button for failed downloads that were organizing
    5. Add subtle animation or pulse effect to "organizing" status badge

    Use existing components (Badge, ProgressBar, Button) and Tailwind utilities. Follow established UI patterns from existing DownloadCard.

    DO NOT change the overall component structure or break existing functionality - only enhance messaging and add copy-to-clipboard feature.
  </action>
  <verify>npm run build succeeds, no TypeScript errors, UI renders correctly with enhanced status messages</verify>
  <done>Organization status more informative, clipboard copy works, retry button added for failed organization</done>
</task>

<task type="auto">
  <name>Task 3: Add configuration toggle for auto-organization</name>
  <files>frontend/src/components/config/ConfigForm.tsx, backend/internal/server/handlers.go</files>
  <action>
    Add optional configuration setting to enable/disable auto-organization:

    **Backend:**
    1. No handler changes needed - config service already supports arbitrary keys
    2. Monitor should check config value "organization.auto_organize" (default: true)
    3. In monitor.go organizeDownload trigger: Check config before auto-organizing
    4. If disabled, download stays at "completed" status (manual organize button remains available)

    **Frontend:**
    1. Add checkbox to ConfigForm: "Auto-organize completed downloads"
    2. Store as "organization.auto_organize" config key
    3. Use existing ConfigStore pattern (no new API calls needed)
    4. Add help text: "When enabled, downloads will be automatically organized after completion. Disable to organize manually."

    CRITICAL: This is an optional enhancement. If not configured, default to true (auto-organize enabled). Preserve backward compatibility.
  </action>
  <verify>go build ./backend/... succeeds, npm run build succeeds, config checkbox works, monitor respects setting</verify>
  <done>Auto-organization toggle works, defaults to enabled, monitor checks config before organizing</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] npm test passes with good coverage on useDownloadStore
- [ ] npm run build succeeds without TypeScript errors
- [ ] go build ./backend/... succeeds without Go errors
- [ ] Manual test: Create download, verify polling shows real-time progress
- [ ] Manual test: Completed download auto-organizes (or manual organize button works)
- [ ] Manual test: Copy path button copies organized_path to clipboard
- [ ] Manual test: Auto-organization toggle affects monitor behavior
</verification>

<success_criteria>

- Store tests pass with >80% coverage on polling and actions
- Organization status displays informative messages during organizing
- Copy-to-clipboard works for organized paths
- Retry button available for failed organization attempts
- Auto-organization configuration toggle works correctly
- No TypeScript errors, no Go build errors
- End-to-end flow verified from download → organized
</success_criteria>

<output>
After completion, create `.planning/phases/05-frontend-integration/05-01-SUMMARY.md`:

# Phase 5 Plan 1: Frontend Integration and UX Enhancement Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description
- `path/to/another.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

[If phase complete: "Phase 5 complete, ready for Phase 6 (End-to-End Testing)"]
[Include any concerns or dependencies that Phase 6 should be aware of]
</output>
